# 用户使用指南 | User Guide

## 目录 | Table of Contents

1. [快速入门](#快速入门)
2. [详细使用说明](#详细使用说明)
3. [音频格式选择指南](#音频格式选择指南)
4. [高级功能](#高级功能)
5. [故障排除](#故障排除)
6. [性能优化](#性能优化)
7. [常见问题](#常见问题)

## 快速入门 | Quick Start

### 第一次使用

1. **确保 FFmpeg 已安装**
   ```bash
   # 检查 FFmpeg 是否可用
   ffmpeg -version
   ```

2. **运行程序**
   ```bash
   ./target/release/video2audio-rs
   ```

3. **按照提示操作**
   - 输入视频文件夹路径
   - 选择音频格式 (1-3)
   - 等待转换完成

### 5分钟快速体验

```bash
# 1. 准备测试视频文件
mkdir ~/test_videos
# 将一些视频文件放入该目录

# 2. 运行程序
./target/release/video2audio-rs

# 3. 输入路径
请输入文件夹的完整路径: /Users/yourname/test_videos

# 4. 选择格式
请输入选项 (1-3): 1

# 5. 等待完成，音频文件将保存在 ~/test_videos/audio_exports/
```

## 详细使用说明 | Detailed Usage

### 程序启动界面

当您运行程序时，会看到如下欢迎界面：

```
╔══════════════════════════════════════════════════════════════╗
║                批量视频转音频工具 (高并发版)                 ║
║                   Video2Audio-RS v0.1.0                     ║
╚══════════════════════════════════════════════════════════════╝

🎵 支持多种视频格式转换为高质量音频文件
⚡ 利用多核 CPU 并行处理，大幅提升转换速度
🛠️  基于 FFmpeg 引擎，确保转换质量和兼容性
```

### 步骤 1: 选择源目录

程序会提示您输入包含视频文件的文件夹路径：

```
📁 请指定要处理的视频文件夹:
   提示: 程序会自动扫描该文件夹及其所有子文件夹

请输入文件夹的完整路径: 
```

**输入要求**:
- 必须是完整的绝对路径
- 目录必须存在且可访问
- 支持包含中文的路径

**示例路径**:
- Windows: `C:\Users\用户名\Videos`
- macOS: `/Users/用户名/Movies`
- Linux: `/home/用户名/Videos`

**路径验证**:
程序会自动验证路径的有效性：
- ✅ 路径存在且是目录
- ❌ 路径不存在
- ❌ 路径是文件而非目录
- ❌ 没有访问权限

### 步骤 2: 选择音频格式

验证路径后，程序会显示格式选择菜单：

```
┌─────────────────────────────────────────────────────────────┐
│                    请选择目标音频格式                        │
├─────────────────────────────────────────────────────────────┤
│  1. MP3 (高质量, 最佳兼容性)                                │
│  2. AAC (直接复制, 速度最快, 零损耗)                        │
│  3. Opus (现代化, 高效率)                                   │
└─────────────────────────────────────────────────────────────┘

请输入选项 (1-3): 
```

**输入方式**:
- 数字选择: `1`, `2`, `3`
- 格式名称: `mp3`, `aac`, `opus` (不区分大小写)

### 步骤 3: 文件扫描

选择格式后，程序开始扫描视频文件：

```
📊 扫描结果:
   找到 15 个视频文件
   输出目录: /Users/yourname/Videos/audio_exports
   开始并行转换处理...
```

**扫描特点**:
- 递归扫描所有子目录
- 自动过滤支持的视频格式
- 显示找到的文件数量
- 自动创建输出目录

### 步骤 4: 转换处理

程序使用多线程并行处理文件：

```
🔄 处理进度: 8/15 (53%)
```

**处理特点**:
- 实时显示进度百分比
- 并行处理多个文件
- 单个文件失败不影响其他文件
- 错误信息会单独显示

### 步骤 5: 完成总结

所有文件处理完成后，显示结果：

```
🎉 转换完成!
   共处理 15 个文件
   所有音频文件已保存至: /Users/yourname/Videos/audio_exports

📊 处理统计:
   ✅ 成功: 13 个文件
   ❌ 失败: 2 个文件
   建议检查失败文件的格式或完整性

感谢使用 Video2Audio-RS! 🎵
```

## 音频格式选择指南 | Audio Format Guide

### MP3 格式 (选项 1)

**特点**:
- 使用 VBR (可变比特率) 最高质量设置
- 最广泛的设备兼容性
- 文件大小适中

**适用场景**:
- 需要在各种设备上播放
- 对兼容性要求高
- 一般音乐收听

**技术参数**:
- 编码器: LAME MP3
- 质量设置: `-q:a 0` (最高质量)
- 比特率: 自动调节 (通常 220-320 kbps)

### AAC 格式 (选项 2)

**特点**:
- 直接复制原始音频流
- 转换速度最快
- 零质量损失 (如果源文件已是 AAC)

**适用场景**:
- 源文件已经是 AAC 编码
- 需要快速批量提取
- 对转换速度要求高

**技术参数**:
- 编码器: 复制模式 (`-c:a copy`)
- 质量: 与源文件相同
- 速度: 最快 (仅复制数据)

**注意事项**:
- 如果源文件不是 AAC，会自动转码
- 某些容器格式可能不支持直接复制

### Opus 格式 (选项 3)

**特点**:
- 最先进的音频编码技术
- 优秀的压缩效率
- 适合网络传输

**适用场景**:
- 需要最小文件大小
- 网络传输或存储空间有限
- 支持现代播放器

**技术参数**:
- 编码器: libopus
- 比特率: 192 kbps
- 特性: 低延迟、高效率

**兼容性注意**:
- 较新的格式，老设备可能不支持
- 现代浏览器和播放器都支持

### 格式选择建议

| 使用场景 | 推荐格式 | 原因 |
|---------|---------|------|
| 一般音乐收听 | MP3 | 兼容性最佳 |
| 快速批量提取 | AAC | 速度最快 |
| 存储空间有限 | Opus | 文件最小 |
| 高质量音乐 | MP3 | 质量与兼容性平衡 |
| 网络分享 | Opus | 传输效率高 |

## 高级功能 | Advanced Features

### 支持的视频格式

程序支持以下视频格式：

**常见格式**:
- MP4 (最常见)
- MKV (高质量容器)
- AVI (传统格式)
- MOV (Apple 格式)

**其他格式**:
- WEBM (网络视频)
- FLV (Flash 视频)
- WMV (Windows 媒体)
- M4V (iTunes 视频)
- 3GP (移动设备)
- TS (传输流)

### 目录结构处理

**输入目录结构**:
```
Videos/
├── 电影/
│   ├── 动作片/
│   │   ├── movie1.mp4
│   │   └── movie2.mkv
│   └── 喜剧片/
│       └── comedy.avi
├── 电视剧/
│   └── series_ep01.mp4
└── 短视频/
    ├── clip1.mov
    └── clip2.webm
```

**输出目录结构**:
```
Videos/
├── audio_exports/          # 自动创建
│   ├── movie1.mp3
│   ├── movie2.mp3
│   ├── comedy.mp3
│   ├── series_ep01.mp3
│   ├── clip1.mp3
│   └── clip2.mp3
└── [原始目录结构保持不变]
```

**特点**:
- 扁平化输出，所有音频文件在同一目录
- 自动处理文件名冲突
- 保留原始文件名（仅更改扩展名）

### 并行处理机制

**自动优化**:
- 根据 CPU 核心数自动调整线程数
- 智能负载均衡
- 内存使用优化

**处理策略**:
- 大文件优先处理
- 错误隔离，单个失败不影响整体
- 实时进度反馈

## 故障排除 | Troubleshooting

### 常见错误及解决方案

#### 1. "FFmpeg 未安装或不在系统 PATH 中"

**原因**: 系统中没有安装 FFmpeg 或 FFmpeg 不在环境变量中

**解决方案**:
```bash
# 检查 FFmpeg 是否安装
ffmpeg -version

# 如果未安装，按照系统类型安装：
# macOS
brew install ffmpeg

# Windows
choco install ffmpeg

# Linux
sudo apt install ffmpeg
```

#### 2. "路径不存在或无法访问"

**原因**: 输入的路径不正确或没有访问权限

**解决方案**:
- 检查路径拼写是否正确
- 确保使用绝对路径
- 检查目录访问权限
- 避免使用特殊字符

#### 3. "未找到任何支持的视频文件"

**原因**: 目录中没有支持的视频格式文件

**解决方案**:
- 检查文件扩展名是否正确
- 确认文件确实是视频文件
- 查看支持的格式列表

#### 4. 转换过程中出现错误

**原因**: 视频文件损坏或格式特殊

**解决方案**:
- 检查源文件是否完整
- 尝试用其他播放器播放源文件
- 尝试不同的音频格式
- 查看详细错误信息

### 性能问题排查

#### 转换速度慢

**可能原因**:
- CPU 性能不足
- 硬盘读写速度慢
- 选择了重编码格式

**优化建议**:
- 使用 AAC 复制模式 (选项 2)
- 确保有足够的可用内存
- 关闭其他占用 CPU 的程序

#### 内存使用过高

**正常情况**:
- 大批量处理时内存使用会增加
- 程序会自动管理内存

**异常情况**:
- 如果内存持续增长，可能是系统问题
- 重启程序通常可以解决

## 性能优化 | Performance Optimization

### 硬件优化建议

**CPU**:
- 多核 CPU 能显著提升并行处理性能
- 推荐 4 核心以上的处理器

**内存**:
- 建议至少 4GB RAM
- 大批量处理建议 8GB 以上

**存储**:
- SSD 硬盘能大幅提升文件读写速度
- 确保有足够的可用空间

### 软件优化建议

**格式选择**:
- AAC 复制模式速度最快
- MP3 质量与速度平衡
- Opus 文件最小但编码较慢

**批量处理**:
- 一次处理大量文件比多次小批量处理更高效
- 避免在转换过程中运行其他重负载程序

**系统设置**:
- 关闭不必要的后台程序
- 确保系统有足够的虚拟内存

## 常见问题 | FAQ

### Q: 程序支持哪些操作系统？
A: 支持 Windows 10+、macOS 10.15+、Linux (Ubuntu 18.04+) 等主流操作系统。

### Q: 可以同时转换多种音频格式吗？
A: 当前版本每次运行只能选择一种输出格式。如需多种格式，请多次运行程序。

### Q: 转换后的音频质量如何？
A: 
- MP3: 使用最高质量 VBR 设置，质量优秀
- AAC: 直接复制原始音频流，无质量损失
- Opus: 现代高效编码，质量/大小比最佳

### Q: 程序会修改原始视频文件吗？
A: 不会。程序只读取原始文件，所有音频文件保存在单独的 `audio_exports` 目录中。

### Q: 如何处理文件名冲突？
A: 程序会自动覆盖同名文件。如需保留多个版本，请手动重命名或移动已转换的文件。

### Q: 支持网络路径吗？
A: 支持，但网络速度会影响处理性能。建议先将文件复制到本地。

### Q: 可以中断转换过程吗？
A: 可以使用 Ctrl+C 中断程序。已完成的文件会保留，未完成的文件会被删除。

### Q: 转换失败的文件怎么处理？
A: 程序会显示失败文件的错误信息。通常是文件损坏或格式特殊导致，可以尝试：
- 使用其他音频格式
- 检查源文件完整性
- 手动使用 FFmpeg 处理

### Q: 如何获得技术支持？
A: 
- 查看项目 GitHub 页面的 Issues
- 阅读详细的错误信息
- 提供系统信息和错误日志

这个用户指南涵盖了从基础使用到高级功能的所有内容，帮助用户充分利用 Video2Audio-RS 的功能。
